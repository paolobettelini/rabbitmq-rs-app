\documentclass[../documentation.tex]{subfiles}

\begin{document}

\subsection{Frontend}

\subsubsection{Yew}

Rust can be compiled into wasm, this allows frameworks such as Yew to exist.
Yew is a Rust framework to build web application using WebAssembly.

\subsection{Database}

The databased is an instance of \texttt{MariaDB}.

\begin{lstlisting}[style=sql]
    CREATE TABLE user (
        id INT PRIMARY KEY AUTO_INCREMENT,
        mail VARCHAR(50) NOT NULL,
        username VARCHAR(25) NOT NULL,
        password BINARY(32) NOT NULL,
        created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
    );
\end{lstlisting}

\begin{lstlisting}[style=sql]
    CREATE TABLE image (
        id INT PRIMARY KEY AUTO_INCREMENT,
        user_id INT NOT NULL,
        uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        data BLOB NOT NULL,
        FOREIGN KEY (user_id)
            REFERENCES user(id)
                ON UPDATE CASCADE
                ON DELETE CASCADE
    );
\end{lstlisting}

\subsubsection{Diesel}

\texttt{diesel} is an ORM library for the Rust programming language.
It supports MySQL, Postgres and SQLite.

\subsection{Load Balancer}

\subsection{Backend}

\subsection{Messaging}

\subsubsection{RabbitMQ}

\subsubsection{Messages}

\newcommand{\tline}{
    \\ \hline
}

\newcommand{\packetstruct}[1]{
    \bgroup{}
    \def\arraystretch{1.25}
    \begin{center}
        \begin{tabular}{|l|l|l|}
            \hline
            \textbf{Field} & \textbf{Type} & \textbf{Description}
            \tline
            
            \if\relax\detokenize{#1}\relax
            \else
                #1
                \tline
            \fi
        \end{tabular}
    \end{center}
    \egroup{}
}

\newcommand{\packetenum}[1]{
    \bgroup{}
    \def\arraystretch{1.25}
    \begin{center}
        \begin{tabular}{|l|l|l|}
            \hline
            \textbf{Field} & \textbf{Content} & \textbf{Description}
            \tline
            
            \if\relax\detokenize{#1}\relax
            \else
                #1
                \tline
            \fi
        \end{tabular}
    \end{center}
    \egroup{}
}

% make links between stuff

\paragraph{RabbitMessage (enum)}
\packetenum{
    LoginRequest & LoginRequestData & Login request packet
    \tline
    LoginResponse & LoginResponseData & Login response packet
    \tline
    RegisterRequest & RegisterRequestData & Register request packet
    \tline
    RegisterResponse & RegisterResponseData & Register response packet
    \tline
    GetImage & GetImageData & Get image data packet
    \tline
    ShrinkAndUpload & ShrinkAndUploadData & Shrink and upload image packet
    \tline
    GetTotalImages & GetTotalImagesData & Get total images packet
    \tline
    GetTotalImagesResponse & GetTotalImagesResponseData & Get total images response
    \tline
    ErrorResponse & ErrorResponseData & Error packet
}

\paragraph{LoginRequestData (struct)}
\packetstruct{
    mail & String & The mail
    \tline
    username & String & The username
    \tline
    password & Vec<u8> & The password
}

\paragraph{LoginResponseData}
\packetenum{
    Ok & LoginResponseDataOk & Positive login response
    \tline
    Err & LoginResponseDataErr & Negative login response
}

\paragraph{LoginResponseDataOk}
\packetstruct{
    token & Vec<u8> & The authentication token
}

\paragraph{LoginResponseDataErr}
\packetenum{
    NotFound & () & User was not not
    \tline
    WrongPassword & () & Password was incorrect
}

TODO...

\end{document}